<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>拆单计算器</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 40px;
      background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(33, 150, 243, 0.2);
      padding: 30px;
      position: relative;
    }

    .back-btn {
      position: absolute;
      top: 20px;
      left: 20px;
      padding: 12px 20px;
      font-size: 18px;
      background: #42a5f5;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(66, 165, 245, 0.4);
    }

    .back-btn:hover {
      background: #1e88e5;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(66, 165, 245, 0.6);
    }

    h1 {
      text-align: center;
      color: #1565c0;
      margin-bottom: 10px;
      font-size: 2.5em;
    }

    .summary {
      text-align: center;
      font-size: 1.2em;
      color: #666;
      margin-bottom: 30px;
      padding: 20px;
      background: #f8f9ff;
      border-radius: 10px;
      border-left: 4px solid #667eea;
    }

    .results-count {
      font-weight: bold;
      color: #667eea;
      font-size: 1.3em;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      text-align: center;
      border-left: 4px solid #42a5f5;
    }

    .stat-card.success {
      border-left-color: #66bb6a;
    }

    .stat-card.warning {
      border-left-color: #42a5f5;
    }

    .stat-card.danger {
      border-left-color: #ef5350;
    }

    .stat-value {
      font-size: 2em;
      font-weight: bold;
      color: #1565c0;
    }

    .stat-label {
      color: #666;
      margin-top: 5px;
    }

    .combination {
      margin: 20px 0;
      padding: 20px;
      background: #f8fbff;
      border-radius: 10px;
      border-left: 4px solid #ba68c8;
    }

    .combination-header {
      font-weight: bold;
      color: #6a1b9a;
      margin-bottom: 10px;
      font-size: 1.1em;
    }

    .combination-items {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin: 10px 0;
    }

    .item {
      padding: 8px 15px;
      background: white;
      border-radius: 6px;
      border: 1px solid #e1f5fe;
    }

    .leftover {
      margin-top: 30px;
      padding: 20px;
      background: #eeeeff;
      border-radius: 10px;
      border-left: 4px solid #ba68c8;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      margin: 10px 0;
    }

    th,
    td {
      border: 1px solid #e0e0e0;
      padding: 12px;
      text-align: center;
    }

    th {
      background: linear-gradient(135deg, #d0a3ff, #cc9dff);
      color: white;
    }

    td:last-child {
      background: #f3e5f5;
      font-weight: bold;
    }
  </style>
</head>

<body>
  <div class="container">
    <button class="back-btn" onclick="history.back()">⬅ 返回</button>
    <h1>拆单方案计算结果</h1>

    <div class="summary" id="resultsSummary">
      <!-- Summary will be populated by JavaScript -->
    </div>

    <div class="stats" id="statsContainer">
      <!-- Stats cards will be populated by JavaScript -->
    </div>

    <div id="combinationsContainer">
      <!-- Combinations will be populated by JavaScript -->
    </div>

    <div id="leftoverContainer">
      <!-- Leftover items will be populated by JavaScript -->
    </div>
  </div>

  <script>
    const results = JSON.parse(localStorage.getItem("combinationResults"));
    const prices = JSON.parse(localStorage.getItem("prices"));
    const target = parseFloat(localStorage.getItem("target"));
    const errt = parseFloat(localStorage.getItem("errt"));
    const originalAvailable = JSON.parse(localStorage.getItem("originalAvailable"));

    function dot(a, b) {
      return a.reduce((sum, val, i) => sum + val * b[i], 0);
    }

    // Update summary
    const summaryElement = document.getElementById('resultsSummary');
    if (results.combinations.length === 0) {
      summaryElement.innerHTML = 'No valid combinations could be created with the given inventory and target.';
      summaryElement.style.background = '#ffebee';
      summaryElement.style.borderLeftColor = '#e57373';
    } else {
      summaryElement.innerHTML = `成功拆成<span class="results-count">${results.combinations.length}</span>单，目标是<span class="results-count">${results.targetCombinations}</span>单。`;
    }

    // Create stats cards
    const statsContainer = document.getElementById('statsContainer');
    statsContainer.innerHTML = `
      <div class="stat-card success">
        <div class="stat-value">${results.combinations.length}</div>
        <div class="stat-label">单数</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">${results.targetCombinations}</div>
        <div class="stat-label">目标单数</div>
      </div>
      <div class="stat-card ${results.successRate >= 0.8 ? 'success' : results.successRate >= 0.5 ? 'warning' : 'danger'}">
        <div class="stat-value">${(results.successRate * 100).toFixed(1)}%</div>
        <div class="stat-label">成功率</div>
      </div>
      <div class="stat-card warning">
        <div class="stat-value">¥${results.leftoverValue.toFixed(2)}</div>
        <div class="stat-label">剩余金额</div>
      </div>
    `;

    // Create combinations display
    const combinationsContainer = document.getElementById('combinationsContainer');
    if (results.combinations.length > 0) {
      combinationsContainer.innerHTML = '<h2 style="color: #1565c0; text-align: center; margin-bottom: 20px;">拆单列表</h2>';

      results.combinations.forEach((combo, index) => {
        const comboDiv = document.createElement('div');
        comboDiv.className = 'combination';
        comboDiv.innerHTML = `
          <div class="combination-header">
            第${index + 1}单：总价¥${combo.total.toFixed(2)} （超出¥${combo.difference.toFixed(2)}）
          </div>
          <div class="combination-items">
            ${combo.items.map((count, i) =>
          count > 0 ? `<div class="item">${count} × ¥${prices[i]} = ¥${(count * prices[i]).toFixed(2)}</div>` : ''
        ).join('')}
          </div>
        `;
        combinationsContainer.appendChild(comboDiv);
      });
    }

    // Create leftover display
    const leftoverContainer = document.getElementById('leftoverContainer');
    if (results.leftoverValue > 0) {
      leftoverContainer.className = 'leftover';
      leftoverContainer.innerHTML = `
        <h3 style="color: #6a1b9a; margin-top: 0;">剩余项目</h3>
        <p>剩余总金额：¥${results.leftoverValue.toFixed(2)}</p>
        <table>
          <tr>
            ${prices.map(p => `<th>¥${p}</th>`).join('')}
            <th>总额</th>
          </tr>
          <tr>
            ${results.leftoverItems.map(item => `<td>${item}</td>`).join('')}
            <td>¥${results.leftoverValue.toFixed(2)}</td>
          </tr>
        </table>
      `;
    } else {
      leftoverContainer.innerHTML = '<div class="stat-card success" style="margin-top: 20px;"><div class="stat-value">100%</div><div class="stat-label">All Items Used</div></div>';
    }
  </script>
</body>

</html>